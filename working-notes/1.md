

### **重构计划 (修订版)**

这是我们将提供给后续 AI 的施工计划。我将为每个阶段撰写独立的、包含完整上下文的描述。

---
### **第一部分: 新架构介绍**

*(这部分将作为后续所有阶段任务的前缀，为AI工作者提供宏观视角)*


大致内容：

组件树结构，eval系统的门面设计

eval系统的内部实现逻辑

三个store（persistenceStore, uiStore, evalStore（被包装））以及下游使用者的数据关系

....? 其他

---
### **第二部分: 具体施工阶段**

#### **阶段 1 (已完成): 核心逻辑修复 - 重写求值引擎**
*   **状态**: 已完成。
*   **产出**: 求值逻辑已从错误的递归模式重构为基于拓扑排序的、可处理并发的迭代模式。

---

阶段2，先把现有的全局ui store拆分成persistenceStore和一个Canvas组件持有一个的非单例uiStore

阶段3，重构出新的新eval子系统（还是叫eval模块？），并写好uistore，eval模块，下层组件的互操作关系