# example-react-flow æŠ€æœ¯ç¬”è®°

> æœ¬æ–‡æ¡£ç”¨äºè®°å½• example-react-flow å­é¡¹ç›®çš„å…³é”®æŠ€æœ¯å®ç°ã€è®¾è®¡æ€è·¯ã€è¸©å‘ä¸ä¼˜åŒ–å»ºè®®ç­‰ã€‚
> å¦‚æœä½ åªæ˜¯åœ¨ç»´æŠ¤æœ¬æ–‡æ¡£è€Œæ²¡æœ‰è´Ÿè´£å…¶ä»–ä»»åŠ¡ï¼Œé‚£ä¹ˆè¯·ä¸è¦ä¸ºå°†è¦å®Œæˆçš„ä»»åŠ¡è®¾æƒ³è§£å†³æ–¹æ¡ˆã€‚åº”è¯¥ç”±è´Ÿè´£è¿™ä¸ªä»»åŠ¡çš„AIæ¥ä¸“é—¨æ€è€ƒè§£å†³æ–¹æ¡ˆã€‚
> ä¿¡æ¯ä¾èµ–æŒ‡å¼•ï¼š
> - è¯·é˜…è¯» working-notes æ–‡ä»¶å¤¹ä¸­çš„å…¶ä»–æ–‡æ¡£ï¼Œä»¥ä¾¿äº†è§£æ•´ä¸ªé¡¹ç›®çš„èƒŒæ™¯å’Œç›®æ ‡ã€‚
> - è¯·é˜…è¯»åŒçº§çš„"ç›®æ ‡æè¿°ä¸ä»»åŠ¡è¿›åº¦.md"ï¼Œå…³äºé¡¹ç›®çš„ç›®æ ‡/éœ€æ±‚çš„è¯¦ç»†æè¿°ä»¥è¯¥æ–‡æ¡£ä¸ºå‡†ã€‚

## ç›®å½•

1. ç»„ä»¶è®¾è®¡ä¸å®ç°è¦ç‚¹
2. å…³é”®äº¤äº’æŠ€æœ¯æ–¹æ¡ˆ
   - 2.1 æ–‡æœ¬æ¨¡å¼ä¸‹æ‹–åŠ¨æ‹‰æ¡†åˆ›å»ºèŠ‚ç‚¹
   - 2.2 èŠ‚ç‚¹çš„åˆ›å»ºã€ç¼–è¾‘ä¸èšç„¦
   - 2.3 è¿æ¥æ¨¡å¼æ–°æ–¹æ¡ˆ
   - 2.4 å·¥å…·æ æ¨¡å¼çš„å…¨å±€ç®¡ç†ä¸è‡ªåŠ¨åˆ‡æ¢
   - 2.5 é¼ æ ‡æ ·å¼çš„å¤šæ¨¡å¼ç»†èŠ‚ä¼˜åŒ–
   - 2.6 èŠ‚ç‚¹ç¼–è¾‘åŒºé˜»æ­¢æ‹–åŠ¨çš„æœ€ä½³å®è·µ
   - 2.7 ä»£ç èŠ‚ç‚¹çš„contentEditableç¼–è¾‘å®ç°
   - 2.8 èŠ‚ç‚¹å®½åº¦è°ƒæ•´åŠŸèƒ½
   - 2.9 å…¨å±€é”®ç›˜äº‹ä»¶ç›‘å¬ä¸è§†é‡æ§åˆ¶
   - 2.10 ç”»å¸ƒçŠ¶æ€çš„åºåˆ—åŒ–ã€æŒä¹…åŒ–ä¸æ¢å¤
3. é‡è¦ç¬¬ä¸‰æ–¹åº“ç”¨æ³•
4. æ€§èƒ½ä¼˜åŒ–ä¸å¯æ‰©å±•æ€§
5. æœªæ¥å¯ä¼˜åŒ–ç‚¹

---

## 1. ç»„ä»¶è®¾è®¡ä¸å®ç°è¦ç‚¹

- ç”»å¸ƒä¸»ç»„ä»¶ï¼šCanvas
- å·¥å…·æ ï¼šToolbar
- è‡ªå®šä¹‰èŠ‚ç‚¹ï¼šTextNode
- è‡ªå®šä¹‰è¾¹ï¼šCustomEdge
- èŠ‚ç‚¹ä¸è¾¹çš„ç±»å‹æ³¨å†Œï¼šåœ¨ Canvas ç»„ä»¶ä¸­é€šè¿‡ nodeTypes å’Œ edgeTypes æ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹å’Œè¾¹ï¼Œä¾¿äºæ‰©å±•ã€‚
- èŠ‚ç‚¹/è¾¹çš„å…¨å±€çŠ¶æ€ç®¡ç†ï¼šä¸»ç”»å¸ƒç”¨ useNodesState/useEdgesStateï¼Œä½†ä¹Ÿæœ‰åŸºäº Zustand çš„ nodeStore å’Œ edgeStoreï¼Œå¯ç”¨äºæ›´å¤æ‚çš„å…¨å±€çŠ¶æ€åŒæ­¥ã€‚

## 2. å…³é”®äº¤äº’æŠ€æœ¯æ–¹æ¡ˆ

### 2.1 æ–‡æœ¬æ¨¡å¼ä¸‹æ‹–åŠ¨æ‹‰æ¡†åˆ›å»ºèŠ‚ç‚¹

**éœ€æ±‚ç®€è¿°ï¼š**
- åœ¨"æ–‡æœ¬"æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·å¯åœ¨ç”»å¸ƒç©ºç™½å¤„æŒ‰ä¸‹é¼ æ ‡å¹¶æ‹–åŠ¨ï¼Œæ‹‰å‡ºä¸€ä¸ªçŸ©å½¢åŒºåŸŸï¼Œæ¾å¼€ååœ¨è¯¥åŒºåŸŸåˆ›å»ºä¸€ä¸ªæ–‡æœ¬/ä»£ç èŠ‚ç‚¹ã€‚
- èŠ‚ç‚¹å®½åº¦ä¸ºæ‹‰æ¡†å®½åº¦ï¼Œé«˜åº¦å§‹ç»ˆä¸º1è¡Œï¼ˆå³æœ€å°é«˜åº¦ï¼‰ï¼Œå¹¶è‡ªåŠ¨è¿›å…¥ç¼–è¾‘æ€ã€‚
- èŠ‚ç‚¹çš„ border ä¸º 1pxï¼Œpadding ä¸º 8pxï¼Œä»£ç åŒºï¼ˆcontentEditable ç¼–è¾‘åŒºï¼‰å æ® border+padding ä¹‹å†…çš„å…¨éƒ¨ç©ºé—´ã€‚

**æŠ€æœ¯å®ç°è¦ç‚¹ï¼š**
1. ä»…åœ¨ activeTool ä¸º 'text' æ—¶ï¼Œç›‘å¬ç”»å¸ƒçš„ onMouseDownã€onMouseMoveã€onMouseUpã€‚
2. é¼ æ ‡æŒ‰ä¸‹æ—¶è®°å½•èµ·ç‚¹ï¼Œæ‹–åŠ¨æ—¶æ¸²æŸ“ä¸€ä¸ªåŠé€æ˜é¢„è§ˆçŸ©å½¢ï¼Œæ¾å¼€æ—¶è®¡ç®—æ‹‰æ¡†çš„å®½åº¦ï¼Œåˆ›å»ºèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹é«˜åº¦å§‹ç»ˆä¸º1è¡Œã€‚
3. åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå°†å®½åº¦ï¼ˆå’Œæœ€å°é«˜åº¦ï¼‰é€šè¿‡ data ä¼ é€’ç»™ TextNodeã€‚
4. ä»£ç èŠ‚ç‚¹ç»„ä»¶æ”¯æŒ data é‡Œä¼ å…¥ widthï¼Œæ¸²æŸ“æ—¶è®¾ç½® style={{ width }}ã€‚
5. é¢„è§ˆçŸ©å½¢éœ€åœ¨ Canvas ä¸Šå±‚æ¸²æŸ“ï¼Œæ ·å¼åŠé€æ˜ã€è¾¹æ¡†è™šçº¿ã€‚
6. èŠ‚ç‚¹å®½åº¦éœ€å‡å» border+paddingï¼Œä¿è¯è§†è§‰ä¸å®é™…ä¸€è‡´ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**
- éœ€å…¼å®¹æœ€å°å®½åº¦ï¼ˆå¦‚ 150pxï¼‰å’Œæœ€å°é«˜åº¦ï¼ˆå¦‚ 40pxï¼‰ã€‚

### 2.2 èŠ‚ç‚¹çš„åˆ›å»ºã€ç¼–è¾‘ä¸èšç„¦

- æ”¯æŒå¤šç§èŠ‚ç‚¹åˆ›å»ºæ–¹å¼ï¼šé€‰æ‹©æ¨¡å¼ä¸‹åŒå‡»ç©ºç™½å¤„ã€æ–‡æœ¬æ¨¡å¼ä¸‹å•å‡»æˆ–æ‹‰æ¡†ã€åº”ç”¨åˆå§‹åŒ–è‡ªåŠ¨æ”¾ç½®ç­‰ã€‚
- é€šè¿‡ initialEditing æ ‡è®°åŒºåˆ†"ç”¨æˆ·æ‰‹åŠ¨æ–°å»ºä»£ç èŠ‚ç‚¹"ï¼ˆéœ€è‡ªåŠ¨è¿›å…¥ç¼–è¾‘æ€ï¼‰å’Œ"åº”ç”¨åˆå§‹åŒ–æ”¾ç½®ä»£ç èŠ‚ç‚¹"ï¼ˆä¸è¿›å…¥ç¼–è¾‘æ€ï¼‰ã€‚
- è‡ªåŠ¨èšç„¦å®ç°ç»†èŠ‚ï¼šä¸èƒ½ç›´æ¥è®¾ç½® isEditing ä¸º trueï¼Œå¦åˆ™ contentEditable ç¼–è¾‘åŒºçš„ autofocus ä¸ç”Ÿæ•ˆã€‚æ­£ç¡®åšæ³•æ˜¯åˆå§‹ä¸º falseï¼Œé€šè¿‡ useEffect ç›‘å¬ initialEditingï¼Œå†åˆ‡æ¢ isEditing ä¸º trueï¼Œä»è€Œç¡®ä¿è‡ªåŠ¨èšç„¦ç”Ÿæ•ˆã€‚

### 2.3 è¿æ¥æ¨¡å¼æ–°æ–¹æ¡ˆ

**èƒŒæ™¯ä¸ç›®æ ‡ï¼š**
- å‚è€ƒ Excalidraw çš„æ— é”šç‚¹è¿æ¥ä½“éªŒï¼Œä¼˜åŒ–è¿æ¥æ¨¡å¼çš„äº¤äº’ã€‚
- ç”¨æˆ·åœ¨"è¿æ¥æ¨¡å¼"ä¸‹ï¼Œæ— éœ€ç²¾ç¡®ç‚¹å‡»é”šç‚¹ï¼Œç›´æ¥åœ¨èŠ‚ç‚¹æœ¬ä½“ä¸ŠæŒ‰ä¸‹é¼ æ ‡å¹¶æ‹–åŠ¨åˆ°ç›®æ ‡èŠ‚ç‚¹å³å¯å®Œæˆè¿æ¥ï¼Œæå‡è¿æ¥æ•ˆç‡å’Œè‡ªç„¶æ€§ã€‚

**å®ç°è¦ç‚¹ï¼š**
1. **è¿æ¥æ¨¡å¼çš„åˆ‡æ¢ä¸çŠ¶æ€ç®¡ç†ï¼š**
   - é€šè¿‡å…¨å±€ activeTool çŠ¶æ€ï¼ˆZustand storeï¼‰åˆ‡æ¢åˆ°"connect"æ¨¡å¼ã€‚
   - å·¥å…·æ æŒ‰é’®å¯åˆ‡æ¢å½“å‰æ¨¡å¼ï¼Œè¿æ¥æ¨¡å¼ä¸‹é¼ æ ‡æ ·å¼å’ŒèŠ‚ç‚¹äº¤äº’å‡æœ‰åŒºåˆ†ã€‚

2. **èŠ‚ç‚¹æœ¬ä½“å³ä¸ºè¿æ¥åŒºåŸŸï¼š**
   - æ¯ä¸ªä»£ç èŠ‚ç‚¹å§‹ç»ˆæ¸²æŸ“è¿æ¥æŠŠæ‰‹ï¼ˆhandleï¼‰ï¼Œä½†ä»…åœ¨è¿æ¥æ¨¡å¼ä¸‹æ˜¾ç¤ºï¼ˆé€šè¿‡ hide-handle ç±»æ§åˆ¶ï¼‰ã€‚
   - è¿æ¥æ¨¡å¼ä¸‹ï¼Œæ•´ä¸ªèŠ‚ç‚¹ä¸»ä½“éƒ½å¯ä½œä¸ºè¿æ¥çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œç”¨æˆ·ä½“éªŒä¸º"æ— é”šç‚¹"ã€‚
   - é€šè¿‡ isConnectable å±æ€§å’Œ activeTool çŠ¶æ€ï¼ŒåŠ¨æ€æ§åˆ¶è¿æ¥æŠŠæ‰‹çš„å¯ç”¨æ€§å’Œå¯è§æ€§ã€‚

3. **è¿æ¥çº¿ä¸è‡ªå®šä¹‰è¾¹ï¼š**
   - è¿æ¥çº¿å’Œæœ€ç»ˆçš„è¾¹å‡ä½¿ç”¨è‡ªå®šä¹‰å®ç°ï¼ˆFloatingEdgeï¼‰ï¼Œé‡‡ç”¨ç›´çº¿è¿æ¥ï¼Œå¹¶å¸¦æœ‰ç®­å¤´ã€‚
   - è¿æ¥ç‚¹çš„è®¡ç®—é‡‡ç”¨èŠ‚ç‚¹å‡ ä½•ä¸­å¿ƒåˆ°ä¸­å¿ƒçš„æœ€çŸ­è·¯å¾„ï¼Œå¹¶é€šè¿‡ getNodeIntersection ç®—æ³•ç¡®ä¿è¿æ¥çº¿è‡ªç„¶åœ°ä»èŠ‚ç‚¹è¾¹ç¼˜å‡ºå‘ã€‚
   - è¿æ¥çº¿æ ·å¼ï¼ˆå¦‚è™šçº¿ã€åŠ¨ç”»ã€ç®­å¤´ï¼‰åœ¨ CSS å’Œ SVG marker ä¸­ç»Ÿä¸€å®šä¹‰ï¼Œé£æ ¼æç®€ã€æœªæ¥æ„Ÿã€‚

4. **è¿æ¥æµç¨‹ï¼š**
   - ç”¨æˆ·åœ¨è¿æ¥æ¨¡å¼ä¸‹ï¼Œç‚¹å‡»æŸä»£ç èŠ‚ç‚¹ä¸»ä½“å¹¶æ‹–åŠ¨åˆ°å¦ä¸€ä»£ç èŠ‚ç‚¹ä¸»ä½“ï¼Œæ¾å¼€é¼ æ ‡å³åˆ›å»ºè¿æ¥ã€‚
   - è¿æ¥è¿‡ç¨‹ä¸­æœ‰è§†è§‰åé¦ˆï¼ˆå¦‚è¿æ¥çº¿é¢„è§ˆï¼‰ã€‚
   - è¿æ¥å®Œæˆåè‡ªåŠ¨åˆ‡å›é€‰æ‹©æ¨¡å¼ï¼ˆå¦‚æœ‰å®ç°ï¼‰ã€‚

5. **ä¸ React Flow çš„é›†æˆï¼š**
   - é€šè¿‡ onConnect å›è°ƒå¤„ç†è¿æ¥äº‹ä»¶ï¼Œè‡ªåŠ¨æ·»åŠ è‡ªå®šä¹‰ç±»å‹çš„è¾¹ã€‚
   - connectionLineComponent æŒ‡å®šè‡ªå®šä¹‰è¿æ¥çº¿ç»„ä»¶ï¼Œä¿è¯è¿æ¥é¢„è§ˆä¸æœ€ç»ˆè¾¹ä¸€è‡´ã€‚

**ä¼˜åŠ¿ä¸ä½“éªŒæå‡ï¼š**
- ç”¨æˆ·æ— éœ€ç²¾ç¡®æ“ä½œé”šç‚¹ï¼Œè¿æ¥æ›´è‡ªç„¶ã€æµç•…ã€‚
- è§†è§‰ä¸Šé”šç‚¹è¢«"éšå½¢"ï¼Œç•Œé¢æ›´ç®€æ´ã€‚
- è¿æ¥çº¿å§‹ç»ˆä»¥æœ€çŸ­è·¯å¾„è¿æ¥èŠ‚ç‚¹è¾¹ç¼˜ï¼Œé¿å…ç©¿é€èŠ‚ç‚¹å†…å®¹ï¼Œæå‡ç¾è§‚æ€§å’Œå¯è¯»æ€§ã€‚
- æ–¹æ¡ˆä¸ºåç»­å®ç°æ›´æ™ºèƒ½çš„è¿æ¥ç‚¹å’Œé«˜çº§äº¤äº’ï¼ˆå¦‚å¤šç±»å‹èŠ‚ç‚¹ã€åŠ¨æ€é”šç‚¹ï¼‰æ‰“ä¸‹åŸºç¡€ã€‚

### 2.4 å·¥å…·æ æ¨¡å¼çš„å…¨å±€ç®¡ç†ä¸è‡ªåŠ¨åˆ‡æ¢

- å·¥å…·æ çš„å½“å‰æ¨¡å¼ï¼ˆactiveToolï¼‰é€šè¿‡ zustand å…¨å±€ storeï¼ˆuseToolStoreï¼‰ç®¡ç†ï¼Œæ‰€æœ‰éœ€è¦æ„ŸçŸ¥å½“å‰æ¨¡å¼çš„ç»„ä»¶å‡å¯ç›´æ¥è¯»å–ã€‚
- å…¸å‹äº¤äº’ï¼š
  - æ–‡æœ¬æ¨¡å¼ä¸‹ï¼Œå•å‡»ç”»å¸ƒç©ºç™½å¤„æˆ–ä»£ç èŠ‚ç‚¹ä¸»ä½“ï¼Œå®ŒæˆèŠ‚ç‚¹åˆ›å»º/ç¼–è¾‘åï¼Œè‡ªåŠ¨åˆ‡å›é€‰æ‹©æ¨¡å¼ã€‚
  - è¿æ¥æ¨¡å¼ä¸‹ï¼Œå®Œæˆä¸€æ¬¡è¿æ¥åï¼ˆå¦‚è¿æ¥åˆ›å»ºæˆåŠŸæˆ–å–æ¶ˆï¼‰ï¼Œä¹Ÿä¼šåˆ‡å›é€‰æ‹©æ¨¡å¼ï¼ˆå¦‚æœ‰å®ç°ï¼‰ã€‚
- è¿™æ ·ä¿è¯äº†äº¤äº’çš„ç›´è§‰æ€§ï¼Œç”¨æˆ·æ— éœ€æ‰‹åŠ¨é¢‘ç¹åˆ‡æ¢æ¨¡å¼ï¼Œä½“éªŒæ›´è´´è¿‘ Excalidraw ç­‰ä¸»æµç”»å¸ƒäº§å“ã€‚

### 2.5 é¼ æ ‡æ ·å¼çš„å¤šæ¨¡å¼ç»†èŠ‚ä¼˜åŒ–

**éœ€æ±‚ï¼š**
- é€‰æ‹©æ¨¡å¼ï¼ˆselectï¼‰ï¼š
  - ç”»å¸ƒç©ºç™½åŒºä¸ºæŠ“æ‰‹ï¼ˆgrabï¼ŒReact Flow é»˜è®¤å³å¯ï¼‰ã€‚
  - ä»£ç èŠ‚ç‚¹ä¸Šæ–¹ä¸º pointerï¼ˆæ‰‹æŒ‡ç‚¹å‡»ï¼‰ã€‚
- æ–‡æœ¬æ¨¡å¼ï¼ˆtextï¼‰ï¼š
  - ç”»å¸ƒç©ºç™½åŒºå’Œä»£ç èŠ‚ç‚¹ä¸Šæ–¹éƒ½ä¸ºæ–‡æœ¬å…‰æ ‡ï¼ˆtextï¼‰ï¼Œæš—ç¤ºå¯è¾“å…¥å’Œç¼–è¾‘ã€‚

**å®ç°è¦ç‚¹ï¼š**
- ç”±äº React Flow é»˜è®¤ä¼šåœ¨ `.react-flow__pane` ä¸Šå¼ºåˆ¶è®¾ç½® `cursor: grab`ï¼Œæ‰€ä»¥ä¸èƒ½ä»…é å¤–å±‚ div çš„ style æ§åˆ¶ç©ºç™½åŒºçš„ cursorã€‚
- è§£å†³æ–¹æ³•ï¼š
  1. åœ¨ Canvas ç»„ä»¶æœ€å¤–å±‚ div ä¸Šæ ¹æ® activeTool åŠ¨æ€æ·»åŠ  `text-mode` classã€‚
  2. åœ¨ `Canvas/styles.css` ä¸­å¢åŠ å¦‚ä¸‹æ ·å¼ï¼š
     ```css
     .text-mode .react-flow__pane {
       cursor: text !important;
     }
     ```
  3. ä»£ç èŠ‚ç‚¹ä¸»ä½“ï¼ˆTextNode ç»„ä»¶ï¼‰æœ€å¤–å±‚ div é€šè¿‡ style åŠ¨æ€åˆ‡æ¢ cursorï¼š
     - select æ¨¡å¼ä¸‹ä¸º pointer
     - text æ¨¡å¼ä¸‹ä¸º text
- è¿™æ ·å³å¯å®ç°å¤šæ¨¡å¼ä¸‹é¼ æ ‡æ ·å¼çš„ç»†è‡´åŒºåˆ†ï¼Œä¸”ä¸ä¼šè¢« React Flow é»˜è®¤æ ·å¼è¦†ç›–ã€‚

**è¸©å‘è®°å½•ï¼š**
- ä»…åœ¨ Canvas å¤–å±‚ div ä¸Šè®¾ç½® cursor æ— æ³•è¦†ç›– React Flow ç”»å¸ƒç©ºç™½åŒºçš„ grab æ ·å¼ï¼Œå¿…é¡»ç”¨æ›´é«˜ä¼˜å…ˆçº§çš„ class é€‰æ‹©å™¨å’Œ `!important`ã€‚
- ä»£ç èŠ‚ç‚¹ä¸»ä½“çš„ cursor å»ºè®®ç›´æ¥ç”¨ style åŠ¨æ€åˆ‡æ¢ï¼Œé¿å…å…¨å±€æ ·å¼æ±¡æŸ“ã€‚

### 2.6 èŠ‚ç‚¹ç¼–è¾‘åŒºé˜»æ­¢æ‹–åŠ¨çš„æœ€ä½³å®è·µ

- åœ¨ React Flow ä¸­ï¼Œå¦‚æœå¸Œæœ›èŠ‚ç‚¹çš„æŸä¸ªåŒºåŸŸï¼ˆå¦‚ç¼–è¾‘æ€ä¸‹çš„ contentEditable ç¼–è¾‘åŒºï¼‰ä¸è§¦å‘èŠ‚ç‚¹æ‹–åŠ¨ï¼Œåªéœ€ç»™è¯¥åŒºåŸŸå…ƒç´ åŠ ä¸Š `nodrag` classã€‚
- è¿™æ ·å¯ä»¥è®©ç”¨æˆ·åœ¨ç¼–è¾‘åŒºå†…è‡ªç”±é€‰ä¸­ã€å¤åˆ¶ã€ç¼–è¾‘æ–‡æœ¬ï¼Œè€Œä¸ä¼šè¯¯è§¦èŠ‚ç‚¹æ‹–åŠ¨æˆ–ç”»å¸ƒ panã€‚
- è¿™ä¸€ç‚¹åœ¨ React Flow çš„å®˜æ–¹æ–‡æ¡£ä¸­å¾ˆéšç§˜ï¼Œè—åœ¨ä¸€ä¸ªä¾‹å­ä¸­ï¼Œä¸ä»”ç»†è§‚å¯Ÿå¾ˆéš¾å‘ç°ã€‚
- å¦å¤–è¿˜æœ‰ `nowheel` classï¼Œå¯ä»¥é˜»æ­¢ç”»å¸ƒæ»šè½®ç¼©æ”¾ã€‚

### 2.7 ä»£ç èŠ‚ç‚¹çš„contentEditableç¼–è¾‘å®ç°

**èƒŒæ™¯ä¸åŠ¨æœº**ï¼š
- é‡‡ç”¨contentEditable ç¼–è¾‘åŒºå¯ä»¥è·å¾—æ›´é«˜çš„è‡ªç”±åº¦ï¼Œå®ç°æ›´æ¥è¿‘ä»£ç ç¼–è¾‘å™¨çš„ä½“éªŒ
- ä¾¿äºå®ç°è¡Œå·ã€è¯­æ³•é«˜äº®ç­‰é«˜çº§åŠŸèƒ½
- ä¸ºåç»­æ‰©å±•æ›´ä¸°å¯Œçš„ä»£ç ç¼–è¾‘åŠŸèƒ½å¥ å®šåŸºç¡€

**å®ç°å…³é”®ç‚¹**ï¼š
1. åŸºæœ¬å®ç°ï¼š
   - ä½¿ç”¨å¸¦æœ‰contentEditable="true"å±æ€§çš„ contentEditable ç¼–è¾‘åŒºä½œä¸ºä»£ç ç¼–è¾‘åŒº
   - å¤„ç†ç¼–è¾‘åŒºå†…å®¹çš„è·å–ä¸è®¾ç½®
2. äº‹ä»¶å¤„ç†ï¼š
   - ä½¿ç”¨onInputäº‹ä»¶ç›‘å¬å†…å®¹å˜åŒ–
   - å¤„ç†é”®ç›˜äº‹ä»¶ï¼Œå¦‚Tabé”®ã€Enteré”®ã€Shift+Enterç»„åˆé”®ç­‰
   - å¤„ç†ç²˜è´´äº‹ä»¶ï¼Œç¡®ä¿ä»£ç æ ¼å¼ä¸€è‡´æ€§
3. å…‰æ ‡ä¸é€‰æ‹©åŒºåŸŸï¼š
   - ä½¿ç”¨Selectionå’ŒRange APIæ‰‹åŠ¨å¤„ç†å…‰æ ‡ä½ç½®
   - å®ç°è‡ªåŠ¨èšç„¦å’Œä¿æŒç¼–è¾‘çŠ¶æ€
4. å ä½ç¬¦æ•ˆæœï¼š
   - ç”±äº contentEditable ç¼–è¾‘åŒºæ²¡æœ‰åŸç”Ÿ placeholder å±æ€§ï¼Œéœ€è¦è‡ªè¡Œå®ç°ç±»ä¼¼æ•ˆæœï¼Œå¦‚é€šè¿‡åŠ¨æ€æ’å…¥/ç§»é™¤é»˜è®¤æ–‡æœ¬
5. æ ·å¼ä¸€è‡´æ€§ï¼š
   - ç¡®ä¿è§†è§‰æ•ˆæœä¸ä»£ç ç¼–è¾‘å™¨ä¸€è‡´
   - ä¿æŒç­‰å®½å­—ä½“ã€è¡Œé«˜ã€æ¢è¡Œç­‰ä»£ç æ˜¾ç¤ºç‰¹æ€§

**è¡¥å……è¯´æ˜**ï¼š
- å·²å®ç°ç‚¹å‡»è¿›å…¥ç¼–è¾‘æ—¶å…‰æ ‡å®šä½åˆ°ç‚¹å‡»å¤„ï¼Œç›¸å…³ç®—æ³•å·²æŠ½è±¡ä¸º placeCaretAtPoint å·¥å…·å‡½æ•°ã€‚
- ä¸ºé˜²æ­¢ React diff å¯¼è‡´çš„å†…å®¹æ®‹å½±ï¼Œç¼–è¾‘æ€å’Œæ˜¾ç¤ºæ€çš„æ ¹èŠ‚ç‚¹åŠ ä¸Šä¸åŒçš„ keyã€‚

### 2.8 èŠ‚ç‚¹å®½åº¦è°ƒæ•´åŠŸèƒ½

**èƒŒæ™¯ä¸åŠ¨æœº**ï¼š
- å›ºå®šå®½åº¦çš„èŠ‚ç‚¹æ— æ³•æ»¡è¶³ä¸åŒé•¿åº¦ä»£ç çš„å±•ç¤ºéœ€æ±‚
- ç”¨æˆ·éœ€è¦æ ¹æ®ä»£ç é•¿åº¦å’Œä¸ªäººåå¥½è°ƒæ•´èŠ‚ç‚¹å®½åº¦
- React Flowæä¾›äº†NodeResizerç»„ä»¶å¯ä»¥å®ç°æ‹–åŠ¨è°ƒæ•´å¤§å°åŠŸèƒ½

**å®ç°å…³é”®ç‚¹**ï¼š
1. **åŸºæœ¬è®¾ç½®**ï¼š
   - å¼•å…¥å®½åº¦è°ƒæ•´æ§åˆ¶ç‚¹ï¼ˆNodeResizeControlï¼‰ç»„ä»¶ï¼Œåˆ†åˆ«ç»å¯¹å®šä½äºä»£ç èŠ‚ç‚¹å·¦å³ä¸¤ä¾§ï¼Œå®½åº¦çº¦8pxï¼Œé«˜åº¦100%ï¼Œå®Œå…¨é€æ˜ä¸”æ— è¾¹æ¡†ã€æ— åœ†è§’ï¼Œä»…åœ¨èŠ‚ç‚¹è¢«é€‰ä¸­æ—¶å¯ç”¨ã€‚
   - é…ç½®æœ€å°å®½åº¦çº¦æŸï¼ˆ200pxï¼‰ï¼Œæ— æœ€å¤§å®½åº¦é™åˆ¶ï¼Œæ”¯æŒæ— é™åˆ¶æ‰©å±•
   - è®¾ç½®åªå…è®¸æ°´å¹³æ–¹å‘è°ƒæ•´å¤§å°ï¼ˆresizeDirection='horizontal'ï¼‰
2. **äº¤äº’ä½“éªŒ**ï¼š
   - ç”¨æˆ·å¯é€šè¿‡æ‹–åŠ¨ä»»æ„ä¸€ä¾§è°ƒæ•´èŠ‚ç‚¹å®½åº¦ï¼Œç¬¦åˆæç®€æœªæ¥æ„Ÿè®¾è®¡è¦æ±‚ã€‚
   - è°ƒæ•´å®½åº¦è°ƒæ•´æ§åˆ¶ç‚¹çš„æ ·å¼ï¼Œä¸æ•´ä½“è®¾è®¡é£æ ¼ä¸€è‡´
   - æ ¹æ®é€‰ä¸­çŠ¶æ€æ§åˆ¶å®½åº¦è°ƒæ•´æ§åˆ¶ç‚¹çš„å¯è§æ€§
3. **çŠ¶æ€ç®¡ç†**ï¼š
   - èŠ‚ç‚¹å¤§å°å˜åŒ–é€šè¿‡onResizeå›è°ƒå®æ—¶æ›´æ–°åˆ°èŠ‚ç‚¹æ•°æ®ä¸­çš„widthå±æ€§
   - å®½åº¦ä¿¡æ¯æŒä¹…åŒ–ä¿å­˜ï¼Œç¡®ä¿åˆ·æ–°åä¿æŒ
   - ç¼–è¾‘æ¨¡å¼å’Œæ˜¾ç¤ºæ¨¡å¼ä¸‹å®½åº¦å®Œå…¨ä¸€è‡´
4. **è¾¹ç¼˜å¤„ç†**ï¼š
   - ä¸è¿æ¥æŠŠæ‰‹ï¼ˆhandleï¼‰çš„åè°ƒï¼Œç¡®ä¿ä¸å½±å“è¿æ¥åŠŸèƒ½
   - ä¸ä»£ç èŠ‚ç‚¹ç¼–è¾‘çŠ¶æ€çš„åè°ƒï¼Œé¿å…å†²çª
5. **React Flowæ ·å¼è¦†ç›–**ï¼š
   - æ·»åŠ CSSè¦†ç›–è§„åˆ™ï¼Œç§»é™¤React Flowé»˜è®¤çš„èŠ‚ç‚¹å®½åº¦é™åˆ¶
   - ä½¿ç”¨`!important`ç¡®ä¿è‡ªå®šä¹‰æ ·å¼ä¼˜å…ˆçº§è¶³å¤Ÿé«˜
6. **æŠ€æœ¯è¦ç‚¹**ï¼š
   - NodeResizeControléœ€åŠ ä¸ŠresizeDirection='horizontal'å±æ€§ï¼Œå¦åˆ™react-flowå¯¹èŠ‚ç‚¹å¤§å°çš„æµ‹é‡ä¼šä¸å‡†ç¡®ï¼Œå½±å“è‡ªå®šä¹‰è¾¹çš„è®¡ç®—ã€‚
   - èŠ‚ç‚¹é«˜åº¦ç›®å‰ç”±å†…å®¹è‡ªé€‚åº”ï¼Œå¦‚éœ€æ”¯æŒé«˜åº¦æ‹–æ‹½éœ€åœ¨èŠ‚ç‚¹æ•°æ®ç»“æ„ä¸­æ˜¾å¼å­˜å‚¨heightï¼Œå¹¶åœ¨æ¸²æŸ“å’ŒNodeResizeControlä¸­ä¼ é€’ã€‚
   - é€æ˜è¿æ¥æŠŠæ‰‹åœ¨æœªé€‰ä¸­æ—¶ä¹Ÿå¯æ‹–åŠ¨ã€‚

**æœ€æ–°å®ç°çŠ¶æ€ï¼ˆâœ… å·²å®Œæˆï¼‰**ï¼š
- âœ… æ”¯æŒ200px-æ— é™åˆ¶çš„å®½åº¦è°ƒæ•´èŒƒå›´
- âœ… ç¼–è¾‘æ¨¡å¼å’Œæ˜¾ç¤ºæ¨¡å¼å®½åº¦å®Œå…¨ä¸€è‡´
- âœ… å®½åº¦è®¾ç½®æŒä¹…åŒ–ä¿å­˜å’Œæ¢å¤
- âœ… æç®€é€æ˜çš„æ‹–æ‹½æ§ä»¶è®¾è®¡
- âœ… ä¸React Flowé»˜è®¤æ ·å¼çš„å…¼å®¹æ€§å¤„ç†

### 2.9 å…¨å±€é”®ç›˜äº‹ä»¶ç›‘å¬ä¸è§†é‡æ§åˆ¶

**éœ€æ±‚ç®€è¿°ï¼š**
- ç›‘å¬å…¨å±€é”®ç›˜äº‹ä»¶ï¼Œå®ç° wasd æ§åˆ¶ç”»å¸ƒå¹³ç§»ï¼ˆpanï¼‰ï¼ŒV/T/C å¿«æ·é”®åˆ‡æ¢æ¨¡å¼ã€‚
- ä¿è¯ä¸è¾“å…¥æ¡†ç­‰ç¼–è¾‘åŒºçš„é”®ç›˜äº‹ä»¶ä¸å†²çªï¼ˆå¦‚ç¼–è¾‘ä»£ç æ—¶ä¸è§¦å‘ pan æˆ–æ¨¡å¼åˆ‡æ¢ï¼‰ã€‚

**æŠ€æœ¯å®ç°è¦ç‚¹ï¼š**
1. åœ¨ Canvas ç»„ä»¶æˆ–å…¨å±€å…¥å£å¤„ç›‘å¬ keydown äº‹ä»¶ã€‚
2. åˆ¤æ–­äº‹ä»¶ç›®æ ‡ï¼Œé¿å…åœ¨ contentEditable/textarea/input ç­‰ç¼–è¾‘åŒºè§¦å‘å¿«æ·é”®ã€‚
3. wasd æ§åˆ¶ panï¼šè°ƒç”¨ React Flow çš„ `setViewport` æˆ– `panBy` æ–¹æ³•ï¼Œæ”¯æŒæŒ‰ä½è¿ç»­ç§»åŠ¨ã€‚
4. V/T/C åˆ‡æ¢æ¨¡å¼ï¼šè°ƒç”¨ zustand çš„ `setActiveTool`ï¼Œå¹¶è§¦å‘è§†è§‰åé¦ˆï¼ˆå¦‚é«˜äº®å·¥å…·æ æŒ‰é’®ï¼‰ã€‚
5. éœ€è€ƒè™‘å¿«æ·é”®ä¸ç³»ç»Ÿ/æµè§ˆå™¨é»˜è®¤è¡Œä¸ºçš„å†²çªï¼Œå¿…è¦æ—¶é˜»æ­¢é»˜è®¤äº‹ä»¶ã€‚
6. ç›¸å…³çŠ¶æ€å’Œå›è°ƒå»ºè®®é›†ä¸­ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚

**æ³¨æ„äº‹é¡¹ï¼š**
- ç¼–è¾‘åŒºèšç„¦æ—¶åº”ç¦ç”¨å¿«æ·é”®ï¼Œé˜²æ­¢å½±å“æ­£å¸¸è¾“å…¥ã€‚
- éœ€å…¼å®¹ä¸åŒæ“ä½œç³»ç»Ÿçš„é”®ç›˜å¸ƒå±€ã€‚

- å·²å°†WASDæƒ¯æ€§/ç¼“åŠ¨å¼ç§»åŠ¨é€»è¾‘å°è£…ä¸º useInertialPan hookï¼Œä¸»ç»„ä»¶åªéœ€è°ƒç”¨å³å¯ï¼Œä¾¿äºç»´æŠ¤å’Œå¤ç”¨ã€‚
- V/T/C å·¥å…·åˆ‡æ¢å¿«æ·é”®ç›‘å¬å•ç‹¬åœ¨ Canvas ç»„ä»¶ä¸­å®ç°ï¼Œé¿å…ä¸æ–¹å‘é”®å†²çªï¼ŒèŒè´£æ¸…æ™°ã€‚

### 2.10 ç”»å¸ƒçŠ¶æ€çš„åºåˆ—åŒ–ã€æŒä¹…åŒ–ä¸æ¢å¤

**éœ€æ±‚ç®€è¿°ï¼š**
- èƒ½å¤Ÿå°†å½“å‰ç”»å¸ƒä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ã€è¾¹ã€èŠ‚ç‚¹å†…å®¹ã€èŠ‚ç‚¹å°ºå¯¸å’Œä½ç½®ç­‰ä¿¡æ¯åºåˆ—åŒ–ä¸ºç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚ JSONï¼‰ï¼Œæ”¯æŒå¯¼å‡ºå’Œå¯¼å…¥ã€‚
- ç”¨æˆ·æ“ä½œåè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°ï¼ˆå¦‚ localStorageï¼‰ï¼Œä¸‹æ¬¡æ‰“å¼€æ—¶èƒ½æ¢å¤ç”»å¸ƒçŠ¶æ€ã€‚
- æä¾›å¯¼å…¥/å¯¼å‡ºæŒ‰é’®ï¼Œä¾¿äºç”¨æˆ·æ‰‹åŠ¨æ“ä½œã€‚

**è®¾è®¡æ€è·¯ä¸æŠ€æœ¯å»ºè®®ï¼š**
1. **æ•°æ®ç»“æ„è®¾è®¡**ï¼š
   - éœ€ä¿å­˜èŠ‚ç‚¹ï¼ˆidã€typeã€dataã€positionã€widthã€heightç­‰ï¼‰ã€è¾¹ï¼ˆidã€sourceã€targetã€typeã€dataç­‰ï¼‰ç­‰å…¨éƒ¨å¿…è¦ä¿¡æ¯ã€‚
   - å¯å‚è€ƒ React Flow çš„å†…éƒ¨èŠ‚ç‚¹/è¾¹ç»“æ„ï¼Œæˆ–è‡ªå®šä¹‰æ‰©å±•ã€‚
2. **åºåˆ—åŒ–ä¸ååºåˆ—åŒ–**ï¼š
   - å¯¼å‡ºæ—¶å°†èŠ‚ç‚¹ã€è¾¹ç­‰çŠ¶æ€åºåˆ—åŒ–ä¸º JSONã€‚
   - å¯¼å…¥æ—¶è§£æ JSONï¼Œæ¢å¤åˆ°ç”»å¸ƒã€‚
   - æ³¨æ„ data å­—æ®µçš„æ·±æ‹·è´ï¼Œé¿å…å¼•ç”¨é—®é¢˜ã€‚
3. **è‡ªåŠ¨ä¿å­˜ä¸æ¢å¤**ï¼š
   - ç›‘å¬èŠ‚ç‚¹/è¾¹çš„å¢åˆ æ”¹ã€æ‹–æ‹½ã€å°ºå¯¸è°ƒæ•´ç­‰æ“ä½œï¼Œè‡ªåŠ¨ä¿å­˜åˆ° localStorageã€‚
   - é¡µé¢åŠ è½½æ—¶æ£€æµ‹ localStorageï¼Œè‡ªåŠ¨æ¢å¤ã€‚
   - å¯è€ƒè™‘ debounce ä¼˜åŒ–ä¿å­˜é¢‘ç‡ã€‚
4. **å¯¼å…¥/å¯¼å‡ºæŒ‰é’®**ï¼š
   - åœ¨å·¥å…·æ æˆ–èœå•ä¸­æä¾›å¯¼å…¥/å¯¼å‡ºæŒ‰é’®ã€‚
   - å¯¼å‡ºæ—¶ä¸‹è½½ JSON æ–‡ä»¶ï¼Œå¯¼å…¥æ—¶é€‰æ‹©æ–‡ä»¶å¹¶è§£æã€‚
5. **ç‰ˆæœ¬å…¼å®¹ä¸æ•°æ®æ ¡éªŒ**ï¼š
   - æ•°æ®ç»“æ„å¯åŠ  version å­—æ®µï¼Œä¾¿äºæœªæ¥å‡çº§å…¼å®¹ã€‚
   - å¯¼å…¥æ—¶æ ¡éªŒæ•°æ®åˆæ³•æ€§ï¼Œå¼‚å¸¸æ—¶ç»™å‡ºæç¤ºã€‚
6. **å¼‚å¸¸å¤„ç†ä¸è¾¹ç•Œæƒ…å†µ**ï¼š
   - localStorage ç©ºé—´ä¸è¶³æ—¶ç»™å‡ºæç¤ºã€‚
   - æ•°æ®æŸåæˆ–ä¸å…¼å®¹æ—¶å¯å›é€€åˆ°åˆå§‹çŠ¶æ€ã€‚

**æ³¨æ„äº‹é¡¹ä¸è¸©å‘ç‚¹ï¼š**
- éœ€å…¼å®¹æœªæ¥èŠ‚ç‚¹/è¾¹ç±»å‹æ‰©å±•ã€‚
- éœ€è€ƒè™‘ localStorage ç©ºé—´é™åˆ¶ï¼Œå¿…è¦æ—¶å¯åšæ•°æ®å‹ç¼©ã€‚
- éœ€å¤„ç†å¾ªç¯å¼•ç”¨ã€æ•°æ®ä¸¢å¤±ç­‰é—®é¢˜ã€‚
- éœ€å…¼å®¹å·²æœ‰èŠ‚ç‚¹/è¾¹çš„åˆ›å»ºã€ç¼–è¾‘ã€æ‹–æ‹½ã€å°ºå¯¸è°ƒæ•´ç­‰æ“ä½œï¼Œç¡®ä¿çŠ¶æ€åŒæ­¥ã€‚
- å¯è€ƒè™‘ä¸ºå¯¼å…¥/å¯¼å‡ºå¢åŠ è¿›åº¦æç¤ºæˆ–é”™è¯¯æç¤ºã€‚

**å®ç°è¡¥å……ï¼š**
- å·²å®ç°è‡ªåŠ¨ä¿å­˜ä¸è‡ªåŠ¨æ¢å¤ï¼Œé‡‡ç”¨ localStorageï¼Œæ•°æ®ç»“æ„å¸¦ç‰ˆæœ¬å·ã€‚
- å¯¼å…¥/å¯¼å‡ºé€šè¿‡ Toolbar æŒ‰é’®è§¦å‘ï¼Œæ”¯æŒ JSON æ–‡ä»¶æ ¼å¼ã€‚
- æŒä¹…åŒ–é€»è¾‘å·²ç‹¬ç«‹å°è£…åœ¨ utils/persistence.tsï¼Œä¾¿äºæœªæ¥æ‰©å±•ã€‚

> åç»­AIå®ç°æ—¶è¯·ä¼˜å…ˆå‚è€ƒæœ¬èŠ‚å†…å®¹ï¼Œå¹¶ç»“åˆå®é™…ä»£ç ç»“æ„çµæ´»è°ƒæ•´ã€‚

## 3. é‡è¦ç¬¬ä¸‰æ–¹åº“ç”¨æ³•

- React Flowï¼šèŠ‚ç‚¹ã€è¾¹ã€ç”»å¸ƒäº¤äº’çš„æ ¸å¿ƒåº“ï¼Œæ”¯æŒè‡ªå®šä¹‰èŠ‚ç‚¹/è¾¹ã€æ‹–æ‹½ã€è¿æ¥ã€ç¼©æ”¾ç­‰ã€‚
- Zustandï¼šè™½ç„¶ä¸»æµç¨‹ç”¨ React Flow çš„ hooks ç®¡ç†èŠ‚ç‚¹/è¾¹ï¼Œä½†ä¹Ÿæœ‰å…¨å±€ store è®¾è®¡ï¼Œä¾¿äºåç»­å¤æ‚çŠ¶æ€åŒæ­¥ã€‚
- CSS æ–¹æ¡ˆï¼šè‡ªå®šä¹‰èŠ‚ç‚¹ã€è¾¹ã€å·¥å…·æ ç­‰å‡æœ‰ç‹¬ç«‹æ ·å¼æ–‡ä»¶ï¼Œéƒ¨åˆ†æ ·å¼é€šè¿‡ç±»ååŠ¨æ€åˆ‡æ¢ï¼ˆå¦‚è¿æ¥æ¨¡å¼ï¼‰ã€‚

## 4. æ€§èƒ½ä¼˜åŒ–ä¸å¯æ‰©å±•æ€§

- èŠ‚ç‚¹/è¾¹çš„å”¯ä¸€ id ç”Ÿæˆï¼šé€šè¿‡å·¥å…·å‡½æ•°ç”Ÿæˆï¼Œé¿å…é‡å¤ã€‚
- èŠ‚ç‚¹/è¾¹çš„ç±»å‹æ‰©å±•ï¼šé€šè¿‡é›†ä¸­æ³¨å†Œ nodeTypes/edgeTypesï¼Œä¾¿äºåç»­æ‰©å±•æ›´å¤šç±»å‹ã€‚
- å…¨å±€çŠ¶æ€ä¸å±€éƒ¨çŠ¶æ€çš„å¹³è¡¡ï¼šç›®å‰ä¸»æµç¨‹ç”¨ React Flow çš„ hooksï¼Œå¤æ‚åœºæ™¯å¯åˆ‡æ¢åˆ° Zustandã€‚

## 5. æœªæ¥å¯ä¼˜åŒ–ç‚¹

- èŠ‚ç‚¹å†…å®¹çš„è‡ªåŠ¨ä¿å­˜ä¸æ’¤é”€/é‡åšã€‚
- æ”¯æŒèŠ‚ç‚¹/è¾¹çš„æ‰¹é‡æ“ä½œä¸å¤šé€‰ã€‚
- ç”»å¸ƒç¼©æ”¾ã€å¹³ç§»çš„æ›´å¤šè‡ªå®šä¹‰äº¤äº’ã€‚
- èŠ‚ç‚¹å†…å®¹çš„è¯­æ³•é«˜äº®ä¸ä»£ç è¡¥å…¨ã€‚
- æ”¯æŒèŠ‚ç‚¹é«˜åº¦è‡ªé€‚åº”å†…å®¹
- ~~æ”¯æŒèŠ‚ç‚¹å®½åº¦æ‹–æ‹½è°ƒæ•´~~ (æ­£åœ¨å®ç°ä¸­)

> æœ¬æ–‡ä»¶æŒç»­å®Œå–„ï¼Œæ¬¢è¿è¡¥å……ã€‚

## é¡¹ç›®ç»“æ„- **å‰ç«¯**: React + TypeScript + Vite + React Flow- **åç«¯**: Julia HTTPæœåŠ¡å™¨ (åŸºäºHTTP.jl)- **æ ¸å¿ƒåŠŸèƒ½**: å¯è§†åŒ–ç¼–ç¨‹èŠ‚ç‚¹ + Juliaä»£ç æ‰§è¡Œ + å˜é‡æ§ä»¶ç³»ç»Ÿ- **çŠ¶æ€ç®¡ç†**: Zustand + React Flow hooks- **æ ·å¼**: TailwindCSS + è‡ªå®šä¹‰CSS- **æ„å»ºå·¥å…·**: Vite + pnpm### å‰ç«¯æ¶æ„- **Canvas**: ä¸»ç”»å¸ƒç»„ä»¶ï¼Œé›†æˆReact Flow- **TextNode**: è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶ï¼Œæ”¯æŒä»£ç ç¼–è¾‘å’Œæ§ä»¶æ˜¾ç¤º- **CustomEdge**: è‡ªå®šä¹‰è¾¹ç»„ä»¶ï¼Œå®ç°æ— é”šç‚¹è¿æ¥- **Toolbar**: å·¥å…·æ ç»„ä»¶ï¼Œæ”¯æŒæ¨¡å¼åˆ‡æ¢- **VariableControls**: å˜é‡æ§ä»¶ç»„ä»¶ï¼Œæ”¯æŒå¤šç§æ§ä»¶ç±»å‹### åç«¯æ¶æ„- **server.jl**: HTTPæœåŠ¡å™¨ä¸»æ–‡ä»¶- **evaluator.jl**: ä»£ç æ‰§è¡Œå¼•æ“- **variable_parser.jl**: å˜é‡è§£æå™¨ï¼Œå¤„ç†@input/@outputæ ‡è®°## å½“å‰æŠ€æœ¯æ ˆè¯¦æƒ…### å·²é‡‡ç”¨çš„æŠ€æœ¯æ ˆ- **React 19.0.0**: å‰ç«¯æ ¸å¿ƒæ¡†æ¶- **@xyflow/react 12.6.0**: ç”»å¸ƒå’ŒèŠ‚ç‚¹ç³»ç»Ÿ- **TypeScript**: ç±»å‹å®‰å…¨çš„å¼€å‘è¯­è¨€- **Vite 6.2.0**: ç°ä»£æ„å»ºå·¥å…·- **TailwindCSS 4.1.5**: åŸå­åŒ–CSSæ¡†æ¶- **Zustand 5.0.3**: è½»é‡çº§çŠ¶æ€ç®¡ç†- **Julia + HTTP.jl**: åç«¯APIæœåŠ¡å™¨- **JSON3.jl**: JSONå¤„ç†åº“### é¡¹ç›®ä¾èµ–å…³ç³»- å‰ç«¯ä¸åç«¯é€šè¿‡HTTP APIé€šä¿¡- React Flowæä¾›ç”»å¸ƒåŸºç¡€èƒ½åŠ›- Zustandç®¡ç†å…¨å±€çŠ¶æ€ï¼ˆå·¥å…·æ æ¨¡å¼ã€è¿æ¥çŠ¶æ€ç­‰ï¼‰- Juliaåç«¯å¤„ç†ä»£ç è§£æå’Œæ‰§è¡Œ## æœ€è¿‘ä¿®å¤çš„é—®é¢˜

### 2024-01-XX ç¼–è¾‘æ¨¡å¼æ˜¾ç¤ºé—®é¢˜å’Œåº•éƒ¨å¼‚å¸¸æ˜¾ç¤º ğŸ”§

**é—®é¢˜æè¿°:**
1. ç¼–è¾‘ä»»ä½•æ§ä»¶æ—¶ï¼ŒoutputåŒºåŸŸå’Œæ§ä»¶åŒºåŸŸä»ç„¶æ˜¾ç¤ºï¼Œå¯¼è‡´æˆªå›¾é”™è¯¯
2. åº•éƒ¨å‡ºç°ä¸¤ä¸ªä¸æ˜æ¥æºçš„æ¡æ˜¾ç¤º"output: 0"å’Œ"slidebar: 0"
3. æ—¥å¿—åŒºåŸŸä½ç½®ä¸æ­£ç¡®ï¼Œåº”è¯¥åœ¨è¾“å‡ºå’Œæ§ä»¶ä¹‹é—´

**å·²ä¿®å¤é—®é¢˜:**
1. âœ… **ç¼–è¾‘æ¨¡å¼æ˜¾ç¤ºæ§åˆ¶**: æ·»åŠ `!isEditing`æ¡ä»¶åˆ°æ‰€æœ‰éœ€è¦åœ¨ç¼–è¾‘æ—¶éšè—çš„åŒºåŸŸ
2. âœ… **æ—¥å¿—åŒºåŸŸä½ç½®**: å°†æ—¥å¿—åŒºç§»åŠ¨åˆ°è¾“å‡ºå’Œæ§ä»¶ä¹‹é—´ï¼Œç¬¦åˆç”¨æˆ·æœŸæœ›
3. âœ… **åˆ†å‰²çº¿æ˜¾ç¤º**: å°†æ–‡å­—åˆ†å‰²çº¿æ”¹ä¸ºè§†è§‰åˆ†å‰²çº¿ï¼Œç§»é™¤"log---------------"æ–‡å­—
4. âœ… **è°ƒè¯•ä¿¡æ¯æ¸…ç†**: ç§»é™¤é¡¶éƒ¨çš„ç¼–è¾‘çŠ¶æ€è°ƒè¯•ä¿¡æ¯

**åº•éƒ¨å¼‚å¸¸æ˜¾ç¤ºé—®é¢˜è¯Šæ–­:**
- æ£€æŸ¥äº†æ‰€æœ‰ç»„ä»¶ä»£ç ï¼Œæœªå‘ç°æ„å¤–çš„è°ƒè¯•æ˜¾ç¤º
- ç¼–è¯‘æ— é”™è¯¯ï¼Œä»£ç ç»“æ„æ­£å¸¸
- å¯èƒ½åŸå› ï¼š
  1. Reactå¼€å‘å·¥å…·çŠ¶æ€æ˜¾ç¤º
  2. æµè§ˆå™¨æ‰©å±•å¹²æ‰°
  3. æŸç§å…¨å±€çŠ¶æ€æˆ–è°ƒè¯•ä¿¡æ¯
  
**å»ºè®®è§£å†³æ–¹æ¡ˆ:**
1. å…³é—­æµè§ˆå™¨å¼€å‘å·¥å…·
2. ç¦ç”¨æµè§ˆå™¨æ‰©å±•
3. å°è¯•æ— ç—•æ¨¡å¼æ‰“å¼€
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
5. é‡å¯å¼€å‘æœåŠ¡å™¨

**ä»£ç ä¿®æ”¹:**
- `TextNode/index.tsx`: æ·»åŠ ç¼–è¾‘æ¨¡å¼æ¡ä»¶åˆ¤æ–­ï¼Œè°ƒæ•´æ¸²æŸ“é¡ºåº
- `TextNode/styles.css`: ç§»é™¤log-headerç›¸å…³æ ·å¼

### 2024-01-XX èŠ‚ç‚¹å¡ç‰‡å®½åº¦è‡ªåŠ¨æ‰©å±•åŠŸèƒ½ âœ…

**éœ€æ±‚èƒŒæ™¯:**
- ç”¨æˆ·åé¦ˆèŠ‚ç‚¹å¡ç‰‡å®½åº¦å›ºå®šï¼Œæ— æ³•é€‚åº”ä¸åŒé•¿åº¦çš„ä»£ç å†…å®¹
- é•¿ä»£ç ä¼šè¢«æˆªæ–­æˆ–è¶…å‡ºå¡ç‰‡è¾¹ç•Œï¼Œå½±å“ç¼–è¾‘å’Œé˜…è¯»ä½“éªŒ
- éœ€è¦å®ç°çœŸæ­£çš„å†…å®¹é©±åŠ¨å®½åº¦æ‰©å±•æœºåˆ¶

**æŠ€æœ¯æŒ‘æˆ˜:**
1. React Flowé»˜è®¤èŠ‚ç‚¹æœ‰å®½åº¦é™åˆ¶
2. CSSçš„fit-contentå’Œmax-contentåœ¨æŸäº›æƒ…å†µä¸‹æ— æ³•æ­£ç¡®å·¥ä½œ
3. ç¼–è¾‘æ¨¡å¼å’Œæ˜¾ç¤ºæ¨¡å¼çš„å®½åº¦è®¡ç®—é€»è¾‘ä¸åŒ
4. ç»å¯¹å®šä½çš„è¯­æ³•é«˜äº®å±‚å¯¼è‡´å®½åº¦è®¡ç®—é”™è¯¯

**å®ç°æ–¹æ¡ˆ:**
1. **CSSåŸºç¡€è®¾ç½®:**
   ```css
   .text-node {
     display: flex;
     flex-direction: column;
     width: fit-content;
     min-width: 300px;
     max-width: none; /* ç§»é™¤æœ€å¤§å®½åº¦é™åˆ¶ */
   }
   ```

2. **JavaScriptåŠ¨æ€å®½åº¦è®¡ç®—:**
   ```javascript
   // ä½¿ç”¨ä¸´æ—¶DOMå…ƒç´ æµ‹é‡æ–‡æœ¬å®é™…å®½åº¦
   const adjustEditorSize = useCallback(() => {
     const tempElement = document.createElement('pre');
     tempElement.style.fontFamily = 'JetBrains Mono, monospace';
     tempElement.style.fontSize = '14px';
     tempElement.style.whiteSpace = 'pre';
     tempElement.style.position = 'absolute';
     tempElement.style.visibility = 'hidden';
     tempElement.textContent = text;
     
     document.body.appendChild(tempElement);
     const contentWidth = tempElement.offsetWidth;
     document.body.removeChild(tempElement);
     
     const minNodeWidth = Math.max(contentWidth + 60, 300);
     nodeContainer.style.width = `${minNodeWidth}px`;
   }, [text]);
   ```

3. **ç¼–è¾‘æ¨¡å¼å’Œæ˜¾ç¤ºæ¨¡å¼åˆ†åˆ«å¤„ç†:**
   - `adjustEditorSize`: ç¼–è¾‘æ¨¡å¼ä¸‹çš„å®½åº¦è°ƒæ•´
   - `adjustDisplayWidth`: æ˜¾ç¤ºæ¨¡å¼ä¸‹çš„å®½åº¦è°ƒæ•´
   - ä¸¤ä¸ªå‡½æ•°éƒ½ä½¿ç”¨ç›¸åŒçš„æµ‹é‡é€»è¾‘ï¼Œç¡®ä¿ä¸€è‡´æ€§

4. **è¯­æ³•é«˜äº®å®¹å™¨ä¼˜åŒ–:**
   ```css
   .syntax-highlight-display, .text-node-editor {
     position: absolute;
     top: 0;
     left: 0;
     right: 0; /* ä½¿ç”¨right: 0è€Œéwidth: 100% */
     white-space: pre; /* ä¿æŒä»£ç æ ¼å¼ */
     overflow: visible; /* å…è®¸æº¢å‡º */
   }
   ```

**å…³é”®æŠ€æœ¯ç‚¹:**
1. **ä¸´æ—¶DOMå…ƒç´ æµ‹é‡æ³•**: åˆ›å»ºä¸å®é™…æ¸²æŸ“ç¯å¢ƒç›¸åŒçš„ä¸´æ—¶å…ƒç´ æ¥ç²¾ç¡®æµ‹é‡æ–‡æœ¬å®½åº¦
2. **Reactæ ·å¼è¦†ç›–**: é€šè¿‡JavaScriptç›´æ¥è®¾ç½®styleå±æ€§ï¼Œä¼˜å…ˆçº§é«˜äºCSS
3. **å®½åº¦è®¡ç®—å…¬å¼**: `contentWidth + 60px`ï¼ˆ60pxåŒ…å«paddingã€marginç­‰ï¼‰
4. **å®æ—¶è°ƒæ•´**: åœ¨æ–‡æœ¬å˜åŒ–ã€ç¼–è¾‘çŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨è°ƒç”¨å®½åº¦è°ƒæ•´å‡½æ•°

**è§£å†³çš„é—®é¢˜:**
- âœ… æ–‡æœ¬è¶…å‡ºå¡ç‰‡è¾¹ç•Œé—®é¢˜
- âœ… ç¼–è¾‘å™¨è¢«æˆªæ–­å¯¼è‡´æ— æ³•ç¼–è¾‘é•¿ä»£ç é—®é¢˜
- âœ… ç¼–è¾‘æ¨¡å¼å’Œæ˜¾ç¤ºæ¨¡å¼å®½åº¦ä¸ä¸€è‡´é—®é¢˜
- âœ… CSS flexå®¹å™¨å®½åº¦è®¡ç®—é”™è¯¯é—®é¢˜

**æ€§èƒ½ä¼˜åŒ–:**
- ä½¿ç”¨ä¸´æ—¶DOMå…ƒç´ è€Œéhidden divï¼Œé¿å…å½±å“å¸ƒå±€
- æµ‹é‡å®Œæˆåç«‹å³ç§»é™¤ä¸´æ—¶å…ƒç´ 
- ä½¿ç”¨useCallbackç¼“å­˜å‡½æ•°ï¼Œé¿å…é‡å¤åˆ›å»º

**è¾¹ç•Œæƒ…å†µå¤„ç†:**
- æœ€å°å®½åº¦300pxä¿è¯ç•Œé¢ç¾è§‚
- ç©ºæ–‡æœ¬æ—¶ä½¿ç”¨å ä½ç¬¦è¿›è¡Œå®½åº¦è®¡ç®—
- å¼‚å¸¸æƒ…å†µä¸‹é™çº§åˆ°é»˜è®¤å®½åº¦

**åç»­æ”¹è¿›æ–¹å‘:**
- è€ƒè™‘ä½¿ç”¨Canvas APIæµ‹é‡æ–‡æœ¬å®½åº¦ï¼Œæé«˜æ€§èƒ½
- å¢åŠ é˜²æŠ–æœºåˆ¶ï¼Œé¿å…é¢‘ç¹è°ƒæ•´
- æ”¯æŒç”¨æˆ·æ‰‹åŠ¨è®¾ç½®æœ€å¤§å®½åº¦é™åˆ¶ 